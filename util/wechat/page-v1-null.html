<!DOCTYPE html>
<html>
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=0, minimum-scale=1.0, maximum-scale=1.0">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <title>终端页</title>
    <link rel="stylesheet" type="text/css" href="css/style.css">
</head>
<body id="Jpage">
    <div id="header">
        <div id="Jnav" class="page-header">
            <div class="page-header-box">
                <div class="troops troops-left">
                    <div class="crown-box">
                        <span class="crown"></span>
                    </div>
                    <img alt="" src="http://www.sinaimg.cn/lf/sports/logo85/60.png">        
                    <p class="troops-name">切尔西</p>
                </div>
                <div class="troops-msg">
                    <p class="troops-plan">进行中</p>
                    <p class="troops-vs">2-0</p>
                </div>
                <div class="troops troops-right">
                    <div class="crown-box">
                        <span class="crown"></span>
                    </div>

                    <img alt="" src="http://www.sinaimg.cn/lf/sports/logo85/52.png">        
                    <p class="troops-name">曼联</p>
                </div>
                <div class="score-box">
                    <span class="pk-logo"></span>
                    <div class="add-good left-good">
                        <span class=""></span>
                        <!--<span class="gooded"></span>
                    点赞后--> <em id="Jnuml">1</em>
                    </div>
                    <div class="add-good right-good"> <em id="JnumR">2</em>
                        <span class=""></span>
                        <!--<span class="gooded"></span>
                    点赞后-->
                    </div>
                    <div class="progress-bar">
                        <span data="1" class="left"></span>
                        <span data="1" class="right"></span>
                    </div>
                </div>
            </div>
        </div>
        <div class="item-tit">球迷区</div>
    </div>
    <div id="wrapper">
        <div class="comment" id="scroller">
            <div id="pullDown">
                <span class="pullDownLabel"></span>
            </div>

            <ul id="Jcomment" class="comment-list"></ul>

            <div id="pullUp">
                <span class="pullUpIcon"></span>
                <span class="pullUpLabel">上拉加载更多...</span>
            </div>

        </div>
    </div>

    <div id="footer">
        <div class="viper-input-group">
            <div class="viper-form-field">
                <input id="Jinput" placeholder="发表评论" type="text"></div>
            <div class="viper-input-group-btn">
                <span>发表</span>
            </div>
        </div>
    </div>

    <!-- 弹窗开始 -->
    <div id="Jpop" class="popup popup-animation">
        <div id="JvsL" class="pop-left">
            <img src="http://www.sinaimg.cn/lf/sports/logo85/60.png" width="50" height="50">
            <p>国际米兰</p>
        </div>
        <div class="pop-center">VS</div>
        <div id="JvsR" class="pop-right">
            <img src="http://www.sinaimg.cn/lf/sports/logo85/52.png" width="50" height="50">
            <p>第聂伯罗</p>
        </div>
        <div class="pop-msg">
            <p>点击队徽支持球队，</p>
            <p>就可以发言啦！</p>
        </div>
        <div class="pop-btcont">
            <div class="pop-share">分享</div>
            <div id="Jclose" class="pop-close">关闭</div>
        </div>
    </div>

<script type="application/javascript" src="http://js.3conline.com/wap/2013/common/js/zepto.min.js"></script>
<script type="application/javascript" src="js/IScroll.js"></script>

<script type="text/javascript">

(function() {

    window.app = {
        bind: function() {
            $('#Jcomment li').each(function(i) {
                // $(this).tap(function() {
                $(this).click(function() {
				
					window.show = !window.show;
					
					if(window.show && $(this).children('.box').children('.cmt-pop').css('display') == 'none' ){
						$(this).children('.box').children('.cmt-pop').show();
						return;
					}
					
					//如果已经显示，那么直接return
					if( $(this).children('.box').children('.cmt-pop').css('display') == 'block'){
						return;
					}
					//如果show是true，而且里面的没显示，表示点击的其他
					if(!window.show && $(this).children('.box').children('.cmt-pop').css('display') == 'none'){
						$('.cmt-pop').hide();
						return;
					}
                });

                var setdate = $(this).find('.set-btn');
                setdate.click(function() {
                    $('#Jinput').focus().val('回复' + setdate.attr('data') + '楼：')
                });

                $(this).find('.report').click(function() {
                    alert('这个是第' + (i + 1) + '楼的举报按钮');
                });
            });

        },
        scrollLoad: function() {
            that=this;
            var myScroll,
                pullDownEl, pullDownOffset,
                pullUpEl, pullUpOffset,
                generatedCount = 4,
                fix = document.getElementById('Jpage');

            /**
             * 上拉返回 （自定义实现此方法）
             * myScroll.refresh();      // 数据加载完成后，调用界面更新方法
             */
            function pullDownAction() {
                setTimeout(function() {
                    myScroll.refresh(); //数据加载完成后，调用界面更新方法   
                }, 1000);
            }

            /**
             * 下拉刷新 （自定义实现此方法）
             * myScroll.refresh();      // 数据加载完成后，调用界面更新方法
             */
            function pullUpAction() {
                setTimeout(function() {
                    var el, li, i;
                    el = document.getElementById('Jcomment');
                    fix.className = 'fix';

                    for (i = 0; i < 10; i++) {
                        li = document.createElement('li');
                        li.innerHTML = '<div class="box"><div class="dPic"><div class="img"><img alt="ooxx" src="https://avatars2.githubusercontent.com/u/3365399?v=3&amp;s=460"></div><div class="medal"><img src="http://www.sinaimg.cn/lf/sports/logo85/60.png"></div></div><div class="dInfo"><p class="date"><span class="name">Gilt</span><span class="time">11-28 16:46 <em>' + (++generatedCount) + '楼</em></span></p><p class="get-c"><span class="set-c">回复12楼Hoosin：</span>ssss</p></div><div class="cmt-pop"><span data="1" class="set-btn">回复</span><span class="report">举报</span></div></div>';
                        el.appendChild(li, el.childNodes[0]);
                    }

                    that.bind()

                    myScroll.refresh(); // 数据加载完成后，调用界面更新方法 
                }, 1000);
            }

            /**
             * 初始化iScroll控件
             */
            function loaded() {
                pullDownEl = document.getElementById('pullDown');
                pullDownOffset = pullDownEl.offsetHeight;
                pullUpEl = document.getElementById('pullUp');
                pullUpOffset = pullUpEl.offsetHeight;

                myScroll = new iScroll('wrapper', {
                    scrollbarClass: 'myScrollbar',
                    /* 重要样式 */
                    useTransition: false,
                    topOffset: pullDownOffset,
                    onRefresh: function() {
                        if (pullUpEl.className.match('loading')) {
                            pullUpEl.className = '';
                            pullUpEl.querySelector('.pullUpLabel').innerHTML = '上拉加载更多...';
                        }
                    },
                    onScrollMove: function() {
                        if (this.y > 0) {
                            pullDownEl.className = 'flip';
                            fix.className = ''
                            this.minScrollY = 0;
                        } else if (this.y < (this.maxScrollY - 5) && !pullUpEl.className.match('flip')) {
                            pullUpEl.className = 'flip';
                            pullUpEl.querySelector('.pullUpLabel').innerHTML = '松手开始更新...';
                            this.maxScrollY = this.maxScrollY;
                        } else if (this.y > (this.maxScrollY + 5) && pullUpEl.className.match('flip')) {
                            pullUpEl.className = '';
                            pullUpEl.querySelector('.pullUpLabel').innerHTML = '上拉加载更多...';
                            this.maxScrollY = pullUpOffset;
                        }
                    },
                    onScrollEnd: function() {
                        if (pullUpEl.className.match('flip')) {
                            pullUpEl.className = 'loading';
                            pullUpEl.querySelector('.pullUpLabel').innerHTML = '加载中...';
                            pullUpAction(); // Execute custom function (ajax call?)
                        }
                    }
                });

                setTimeout(function() {
                    document.getElementById('wrapper').style.left = '0';
                }, 800);
            }

            //初始化绑定iScroll控件 
            document.addEventListener('touchmove', function(e) {
                e.preventDefault();
            }, false);
            document.addEventListener('DOMContentLoaded', loaded, false);
        },
        init: function() {
            app.scrollLoad();
            this.bind();

 
            if ($('#Jcomment').children().length==0) {
                $('#Jcomment').after('<div style="height:100px; text-align: center; padding-top:50px; font-size: 18px; font-family:黑体">暂无留言<span> 点击发评论</span></div>');
                $('#pullUp').hide();
                $('#wrapper').css("background",'#fff')
            };

            $('#Jinput').click(function() {
                $('#Jpop').show();
            });

            $('#JvsL').click(function() {
                $('.troops-left .crown').addClass('show-inline');
                $('#Jpop').hide();
            });

            $('#JvsR').click(function() {
                $('.troops-right .crown').addClass('show-inline');
                $('#Jpop').hide();
            });

            $('#Jclose').click(function() {
                $('#Jpop').hide();
            });
        }
    }

    app.init();

})();


 


</script>

</body>
</html>